---
title: "stp25settings"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
require(knitr)
 
 
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  out.width = "100%",
  comment = "#"
)

options(
  knitr.kable.NA = "",
  width = 60
)


```

# stp25stat2



Bietet ein einfaches und intuitives Formula und Pipe-freundliches Framework, um grundlegende statistische Tests durchzuf체hren, zum Beispiel t-Test, Wilcoxon-Test, ANOVA, Kruskal-Wallis und Korrelationsanalysen.
   
Die Ausgabe jedes Tests wird automatisch in einen APA-Style conforme Tabelle umgewandelt.
     
Zus채tzliche Funktionen  zum Umformen, Neuordnen, Manipulieren sind in *spp25tools* enthalten. Funktionen zur Visualisierung sind in *stp25plot* enthalten.
  
## Key functions 

```{r}
require(stp25settings)
require(stp25stat2)

which_output()
```

  
### Descriptive statistics
   
- `Tbll_desc`, `Tbll_desc_long()`,  `Tbll_desc_item()` und `Tbll_desc_multi` : Berechnen deskriptive Statistiken f체r eine oder mehrere numerische Variablen. Kann mit gruppierten Daten umgehen.
- `Tbll_xtabs()`: Berechnet H채ufigkeitstabelle kategorialer Variablen.




```{r, Tbll_desc, error=TRUE}

Tbll_desc(~ breaks + wool, warpbreaks)

warpbreaks %>% Tbll_desc(~breaks + wool)

warpbreaks %>% Tbll_desc(breaks, wool)
```
    
    
```{r, Tbll_desc_adv}
warpbreaks %>% Tbll_desc(
  "H1",
  breaks,
  tension,
  by = ~ wool,
  include.total = TRUE,
  include.n = FALSE,
  include.test = TRUE) %>% kable()
```
    
    
     
```{r, Tbll_desc_long, results='asis'}
mtcars %>% Tbll_desc_long(
  mpg[mean, 1],  cyl[median],  disp[0],
  hp[0],  drat,  wt,  qsec[1],  vs[freq],
  am[freq],  gear,  carb,
  include.range = TRUE,  include.n = TRUE
) %>% kable(caption ="summary statistics" )
```
 
 
```{r, include=FALSE}
require(stp25stat2)
require(stp25tools)
n<- 100
set.seed(1)
DF <- data.frame(
  sex= gl(2, n/3, labels = c("male", "female"))[sample.int(n)],
  group = gl(2, n/3, labels = c("Control", "Treat"))[sample.int(n)],
  age= runif(n, min = 18, max = 73),
  smoker =  rbinom(n, size=1, prob=.25)==1,
  alc = gl(3, n/3, labels = c("non", "Occasionally", "Abuse"))[sample.int(n)],
  diabet=  rbinom(n, size=1, prob=.5)==1,
  metabolic = rbinom(n, size=1, prob=.3)==1,
  cardo=  rbinom(n, size=1, prob=.1)==1,
  infect= factor( rbinom(n, size=1, prob=.77), 0:1, c("yes", "no")),
  bili=  rnorm(n, 0.83, 0.40)
) %>% 
  na.omit %>% 
  Label(
  smoker = "Tobacco Smoker",
  group = "Group",
  sex = "Sex",
  alc = "Alcohol Consumption",
  age="Age",
  
 diabet= "Diabetes" ,
 cardo = "Cardiovascular Disease" ,
 metabolic =  "Chronic Metabolic Disease ",
 infect = "Chronic Infections" ,
  bili = "Serum Bilirubin (mg/dl)"
    
)

      
```


```{r}
set_opt(
  caption=TRUE,
  median = list(digits = 0, style=1),
  prozent = list(style=2, 
                 digits=1,
                 percentage_str="%",
                 
                 null_percent_sign =  ' . ',
                 
                 include_level_multi = TRUE)
) 
```



 
```{r, results='asis'}
DF %>%
  Tbll_desc(
    sex[ratio],
    group[freq],
    age[median],
    alc, smoker,
    "Clinical/Pretreatment",
    diabet,
    cardo,
    metabolic,
    infect[multi],
    bili[median,3],
    
    by = ~ group,
    include.total = TRUE,
    
    include.custom = stp25stat2:::effect_size
    # include.custom =  function(x ,
    #                            by, ...) {
    #   x <- scale(as.numeric(x))
    #   round(diff(sapply(split(x, by), mean, na.rm = TRUE)), 2)
    # },
    # 
    # include.value = c(group = "OR = .0256", sex = "swx = 26")
  ) %>% stp25output2::Output()
```
 
 
```{r}
Info <- data.frame( var_name=c("age", "sex"), y=1:2)
rownames(Info) <- c("age", "sex" )
DF %>%
  Tbll_desc(
    sex[ratio],
    group[freq],
    "Zwichen Ueberschrift",
    age[median],
    by = ~ group,
    include.total = TRUE,
    include.value = Info,
    include.nr = TRUE
  ) %>% kable()
```
 
     
     
### Correlation analysis
   
 
   
- `Tbll_corr()()`: Korrelationstest zwischen zwei oder mehr Variablen mit Pearson-, Spearman- oder Kendall-Methoden.
 
 
 
 
 
 
- `Tbll_corr()`: Compute the mode of a vector, that is the most frequent values.
- `Tbll_desc_long()`: Detect univariate outliers using boxplot methods. 
- `Tbll_desc_item()`: Compute Mahalanobis Distance and Flag Multivariate Outliers.
- `Tbll_likert()` and `mshapiro_test()`: Univariate and multivariate Shapiro-Wilk normality test.
    
 
